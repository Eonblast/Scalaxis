diff -U 3 -H -d -r -N -x .git -x .svn -- yaws-1.90/src/json.erl yaws-1.90.encode_unicode_keys/src/json.erl
--- yaws-1.90/src/json.erl	2011-05-25 23:33:26.000000000 +0200
+++ yaws-1.90.encode_unicode_keys/src/json.erl	2011-05-31 17:37:51.632385085 +0200
@@ -168,7 +168,12 @@
     M = obj_fold(fun({Key, Value}, Acc) ->
 	S = case Key of
             B when is_binary(B) -> encode_string(B);
-	    L when is_list(L) -> encode_string(L);
+	    L when is_list(L) ->
+            case is_string(L) of
+                yes -> encode_string(L);
+                unicode -> encode_string(xmerl_ucs:to_utf8(L));
+                no -> exit({json_encode, {bad_key, Key}})
+            end;
 	    A when is_atom(A) -> encode_string(atom_to_list(A));
             _ -> exit({json_encode, {bad_key, Key}})
 	end,
@@ -573,7 +578,9 @@
 %% Store a new member in an object.  Returns a new object.
 
 obj_store(KeyList, Value, {struct, Props}) when is_list(Props) ->
-	Key = list_to_atom(KeyList),
+	Key = try list_to_atom(KeyList)
+          catch error:badarg -> KeyList
+          end,
     {struct, [{Key, Value} | proplists:delete(Key, Props)]}.
 
 %% Create an object from a list of Key/Value pairs.
diff -U 3 -H -d -r -N -x .git -x .svn -- yaws-1.90/src/json2.erl yaws-1.90.encode_unicode_keys/src/json2.erl
--- yaws-1.90/src/json2.erl	2011-05-25 23:33:26.000000000 +0200
+++ yaws-1.90.encode_unicode_keys/src/json2.erl	2011-05-31 17:38:12.957368191 +0200
@@ -127,7 +127,12 @@
     M = obj_fold(fun({Key, Value}, Acc) ->
 	S = case Key of
             B when is_binary(B) -> encode_string(B);
-	    L when is_list(L) -> encode_string(L);
+	    L when is_list(L) ->
+            case is_string(L) of
+                yes -> encode_string(L);
+                unicode -> encode_string(xmerl_ucs:to_utf8(L));
+                no -> exit({json_encode, {bad_key, Key}})
+            end;
 	    A when is_atom(A) -> encode_string(atom_to_list(A));
             _ -> exit({json_encode, {bad_key, Key}})
 	end,
